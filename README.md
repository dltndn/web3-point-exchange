# λΈ”λ΅μ²΄μΈ κΈ°λ° μ¬ν™” κµν™ μ„λΉ„μ¤

## κ°μ”

λ³Έ ν”„λ΅μ νΈλ” Web2 κΈ°λ°μ ν¬μΈνΈ μ¬ν™”μ™€ λΈ”λ΅μ²΄μΈ κΈ°λ°μ κ±°λ²„λ„μ¤ ν† ν°μ„ μ—°κ²°ν•λ” μ¬ν™” κµν™ μ„λΉ„μ¤μ…λ‹λ‹¤. μ‚¬μ©μλ” ν¬μΈνΈλ¥Ό νλ“ν•κ³  μ†λΉ„ν•  μ μμΌλ©°, κ³ μ • λΉ„μ¨λ΅ λΈ”λ΅μ²΄μΈ ν† ν°κ³Ό κµν™ν•  μ μμµλ‹λ‹¤. μ „μ²΄ μ‹μ¤ν…μ€ Docker Composeλ¥Ό ν†µν•΄ κµ¬μ„±λμ–΄ μμΌλ©°, Frontend(Next.js), Backend(NestJS), Blockchain(Hardhat), Database(PostgreSQL), Cache(Redis), Message Queue(RabbitMQ)λ΅ κµ¬μ„±λ©λ‹λ‹¤.

## ν”„λ΅μ νΈ μ„Έν… κ°€μ΄λ“

### μ‚¬μ „ μ¤€λΉ„ μ‚¬ν•­

- Docker Desktop μ„¤μΉ (Compose V2 μ§€μ›)
- λΈλΌμ°μ € ν™•μ¥ ν”„λ΅κ·Έλ¨ MetaMask μ„¤μΉ
- ν™κ²½λ³€μ νμΌ `.env` μƒμ„± ν•„μ”

### μ£Όμ μ‚¬ν•­

- κ°™μ€ ν™κ²½ λ³€μ(ethereum κ³„μ •)λ΅ ν”„λ΅μ νΈλ¥Ό λ™μ‹μ— μ‹¤ν–‰ν•λ©΄ nonce μ¶©λλ΅ μΈν• μ¤λ¥κ°€ λ°μƒν•  μ μμµλ‹λ‹¤.

### ν™κ²½λ³€μ μ„¤μ •

ν”„λ΅μ νΈ λ£¨νΈμ `.env.example` νμΌμ„ λ³µμ‚¬ν•μ—¬ `.env` νμΌμ„ μƒμ„±ν•κ³  λ‹¤μ ν™κ²½λ³€μλ¥Ό μ„¤μ •ν•©λ‹λ‹¤:

```bash
cp .env.example .env
```

### μ»¨νΈλ™νΈ λ°°ν¬ λ° μ„Έν…

μ»¨νΈλ™νΈ λ°°ν¬ λ° μ„¤μ •μ— λ€ν• μμ„Έν• λ‚΄μ©μ€ [μ»¨νΈλ™νΈ μ„¤μ • κ°€μ΄λ“](./CONTRACT_SETTING_GUIDE.md)λ¥Ό μ°Έκ³ ν•μ„Έμ”.

### Docker Compose μ‹¤ν–‰

1. **μ „μ²΄ μ„λΉ„μ¤ μ‹μ‘**
```bash
docker compose up -d
```

2. **λ΅κ·Έ ν™•μΈ**
```bash
# μ „μ²΄ μ„λΉ„μ¤ λ΅κ·Έ
docker compose logs -f

# νΉμ • μ„λΉ„μ¤ λ΅κ·Έ
docker compose logs -f frontend
docker compose logs -f backend
docker compose logs -f blockchain
```

3. **μ„λΉ„μ¤ μ¤‘μ§€**
```bash
# μ „μ²΄ μ„λΉ„μ¤ μ¤‘μ§€
docker compose down

# λ³Όλ¥¨κΉμ§€ μ‚­μ 
docker compose down -v
```

### μ„λΉ„μ¤ μ ‘κ·Ό μ •λ³΄

| μ„λΉ„μ¤ | ν¬νΈ | μ ‘κ·Ό URL |
|--------|------|----------|
| Frontend | 3000 | http://localhost:3000 |
| Backend | 3001 | http://localhost:3001 |
| Blockchain | 8545 | http://localhost:8545 |
| PostgreSQL | 5432 | localhost:5432 |
| RabbitMQ (AMQP) | 5672 | localhost:5672 |
| RabbitMQ (Management) | 15672 | http://localhost:15672 |

### ν—¬μ¤μ²΄ν¬

λ¨λ“  μ„λΉ„μ¤κ°€ μ •μƒμ μΌλ΅ μ‹¤ν–‰λκ³  μλ”μ§€ ν™•μΈν•©λ‹λ‹¤:

```bash
# μ„λΉ„μ¤ μƒνƒ ν™•μΈ
docker compose ps

# ν—¬μ¤μ²΄ν¬ μƒνƒ ν™•μΈ
docker compose exec backend curl http://localhost:3000/health
```

## ν”„λ΅μ νΈ μ‹¤ν–‰ κ°€μ΄λ“

### λΉλ“ λ° μ‹¤ν–‰ μ‹κ°„
- μ•½ 3λ¶„μ μ»΄νμΌ λ° λΉλ“ μ‹κ°„μ΄ μ†μ”λ©λ‹λ‹¤ (λ„¤νΈμ›ν¬ μƒν™©μ— λ”°λΌ μƒμ΄ν•¨)

### μ‹¤ν–‰ ν™•μΈ μ μ°¨
1. **Blockchain μ»¨ν…μ΄λ„ μƒνƒ ν™•μΈ**
   ```bash
   docker compose logs -f blockchain
   ```
   - ν¬μΈνΈ μ„λ²„μ— μ”μ²­ν• ν—¬μ¤ μ²΄ν¬ μ„±κ³µ μ—¬λ¶€λ¥Ό ν™•μΈν•©λ‹λ‹¤
      ```bash
      blockchain  | π” ν—¬μ¤μ²΄ν¬ μ‹λ„ 3/36...
      blockchain  | β… Point Server ν—¬μ¤μ²΄ν¬ μ„±κ³µ!
      blockchain  | π“ μ‘λ‹µ μƒνƒ: 200
      blockchain  | π“‹ μ‘λ‹µ λ°μ΄ν„°: {
      blockchain  |   status: 'ok',
      blockchain  |   timestamp: '2025-07-24T07:56:07.959Z',
      blockchain  |   service: 'Point Server API'
      blockchain  | }
      ```
   - μ»¨νΈλ™νΈ μ΄λ²¤νΈ μ΅°ν κΈ°λ¥ μ •μƒ μ‘λ™ μ—¬λ¶€λ¥Ό ν™•μΈν•©λ‹λ‹¤
      ```bash
      blockchain  | β° 2025-07-24T07:53:17.439Z - μƒλ΅μ΄ λΈ”λ΅ κ°μ§€
      blockchain  | π” μ΄λ²¤νΈ μ΅°ν μ¤‘... λΈ”λ΅ λ²”μ„: 28787653 - 28787654
      blockchain  | π“ λ°κ²¬λ μ΄λ²¤νΈ: PointDeposited(0), PointWithdrawn(0), ValidUserSet(0)
      blockchain  | β… λΈ”λ΅ 28787654κΉμ§€ μ²λ¦¬ μ™„λ£
      ```

2. **μ›Ή μ• ν”λ¦¬μΌ€μ΄μ… μ ‘μ†**
   - ν¬λ΅¬ λΈλΌμ°μ €λ¥Ό ν†µν•΄ [localhost:3000](http://localhost:3000)μΌλ΅ μ ‘μ†ν•©λ‹λ‹¤
   - μ²μ νμ΄μ§€ μ§„μ… μ‹ μ»΄νμΌ μ‘μ—…μΌλ΅ μΈν• λ΅λ”© μ‹κ°„μ΄ μ†μ”λ©λ‹λ‹¤
   - μ°μΈ΅ μƒλ‹¨μ μ§€κ°‘ μ—°κ²° λ²„νΌμ„ ν΄λ¦­ν•μ—¬ μ§€κ°‘μ„ μ—°κ²°ν•©λ‹λ‹¤

## λΈ”λ΅μ²΄μΈ

### κΈ°μ  μ¤νƒ
- **μ»¨νΈλ™νΈ μ–Έμ–΄**: Solidity
  - μ΄λ”λ¦¬μ›€ λΈ”λ΅μ²΄μΈμ—μ„ μ¤λ§νΈ μ»¨νΈλ™νΈλ¥Ό μ‘μ„±ν•κΈ° μ„ν• ν‘μ¤€ μ–Έμ–΄
  - ν’λ¶€ν• λ¬Έμ„ λ° μ»¤λ®¤λ‹ν‹° μ§€μ›

- **κ°λ° ν”„λ μ„μ›ν¬**: Hardhat
  - μ΄λ”λ¦¬μ›€ μ¤λ§νΈ μ»¨νΈλ™νΈμ κ°λ°, ν…μ¤νΈ, λ°°ν¬λ¥Ό ν¨μ¨μ μΌλ΅ μ²λ¦¬
  - λ΅μ»¬ μ΄λ”λ¦¬μ›€ λ„¤νΈμ›ν¬ μ κ³µ
  - λ‹¤μ–‘ν• ν”λ¬κ·ΈμΈ μ§€μ›

### μ»¨νΈλ™νΈ μ •λ³΄
- **μ²΄μΈ**: Base Sepolia
- **μ»¨νΈλ™νΈ μ£Όμ†**:
  - PointManager: [0xFC0198d7246532E530f80F76B0f1cF2586Eae397](https://sepolia.basescan.org/address/0xFC0198d7246532E530f80F76B0f1cF2586Eae397)
  - BloomToken: [0x47aF3894e57c9075371DB7f5EfC5122B2a6AE65c](https://sepolia.basescan.org/address/0x47aF3894e57c9075371DB7f5EfC5122B2a6AE65c)

### μ£Όμ” κΈ°λ¥
- EIP-712 μ„λ… κΈ°λ° ν¬μΈνΈ κµν™ νΈλμ­μ… μ‹¤ν–‰

### μ‚¬μ© λ°©λ²•
1. **ν…μ¤νΈ μ½”λ“ μ‹¤ν–‰**
   ```bash
   REPORT_GAS=true npx hardhat test
   ```

2. **μ»¨νΈλ™νΈ λ°°ν¬**
   ```bash
   npx hardhat run scripts/pointManager.ts --network baseSepolia
   ```
   - BloomToken μ»¨νΈλ™νΈ λ°°ν¬ λ° ν† ν° λ°ν–‰κΉμ§€ μ‹¤ν–‰

3. **ν¬μΈνΈ κ΄€λ¦¬ μ»¨νΈλ™νΈ μ΄μ**
   ```bash
   npx hardhat run scripts/pointManager.ts --network baseSepolia
   ```

### μ°Έκ³  μ‚¬ν•­
- μ„λ²„μ— μ»¨νΈλ™νΈ μ΄λ²¤νΈ λ΅κ·Έλ¥Ό μ „λ‹¬ν•λ” μ¤ν¬λ¦½νΈκ°€ λ™μ‘ν•©λ‹λ‹¤


## μ„λ²„

### κΈ°μ  μ¤νƒ
- **μ–Έμ–΄**: TypeScript
  - ν’λ¶€ν• Web3 κ΄€λ ¨ λΌμ΄λΈλ¬λ¦¬λ΅ μ΄λ”λ¦¬μ›€κ³Όμ μ—°λ™μ΄ μ λ¦¬
  - νƒ€μ… μ²΄ν¬λ¥Ό ν†µν•΄ ν΄λ¨Ό μ—λ¬λ¥Ό μ¤„μ΄λ” λ° ν° μ΄μ  μ κ³µ

- **ν”„λ μ„μ›ν¬**: NestJS
  - λ¨λ“ κΈ°λ° μ•„ν‚¤ν…μ²μ™€ λ°μ½”λ μ΄ν„° λ¬Έλ²•μΌλ΅ ν™•μ¥μ„±μ΄ λ›°μ–΄λ‚¨
  - μΌκ΄€λ μ½”λ“ μ‘μ„± κ°€λ¥

- **λ°μ΄ν„°λ² μ΄μ¤**: PostgreSQL

- **λ©”μ‹μ§€ ν**: RabbitMQ
  - λΈ”λ΅μ²΄μΈ νΈλμ­μ… ν κ΄€λ¦¬
  - λ¶€ν• λ¶„μ‚°

### ν…μ΄λΈ” κµ¬μ΅°
![ERD](backend/images/erd_image.png)

### μ£Όμ” λ΅μ§
- **ν¬μΈνΈλ¥Ό ν† ν°μΌλ΅ κµν™**
  ![Deposit Point Sequence Diagram](backend/images/DepositPointSequenceDiagram.png)

- **ν† ν°μ„ ν¬μΈνΈλ΅ κµν™**
  ![Withdraw Point Sequence Diagram](backend/images/WithdrawPointSequenceDiagram.png)

- **ν κΈ°λ° νΈλμ­μ… μ²λ¦¬**
  ![Transaction Queue Flow](backend/images/tx_queue_flow.png)

### μ„λ²„ νΉμ§•
- MSA κµ¬μ΅°μ μ‹μ¤ν…μ—μ„ ν¬μΈνΈ λ„λ©”μΈμ„ λ‹΄λ‹Ή
- μ μ € ν…μ΄λΈ”μ€ μ›ν™ν• ν…μ¤νΈλ¥Ό μ„ν•΄ μ„μ‹λ΅ μƒμ„±

### μƒλµλ κΈ°λ¥
- λ‹¤λ¥Έ μ„λ²„μ™€μ ν†µμ‹  λ° μΈμ¦
- λΈ”λ΅μ²΄μΈ κ³„μ • λ³΄μ• κ΄€λ¦¬
- μ μ‹¤λ λΈ”λ΅ μ •λ³΄ λ³µκµ¬ μ²λ¦¬

## ν΄λΌμ΄μ–ΈνΈ

### κΈ°μ  μ¤νƒ
- **μ–Έμ–΄**: TypeScript
  - μ„λ²„ κ°λ°κ³Ό λ™μΌν•κ² μ‚¬μ©ν•μ—¬ μ½”λ“μ μ•μ •μ„±κ³Ό κ°€λ…μ„± ν™•λ³΄

- **ν”„λ μ„μ›ν¬**: Next.js
  - React κΈ°λ° ν”„λ μ„μ›ν¬
  - μ΄λ”λ¦¬μ›€κ³Ό μ‰½κ² μ—°λ™ν•  μ μλ” λ‹¤μ–‘ν• λΌμ΄λΈλ¬λ¦¬ ν™μ© κ°€λ¥

### μ£Όμ” νΉμ§•
- λΈ”λ΅μ²΄μΈ μ§€κ°‘ μ—°λ™ (MetaMask)
- ν¬μΈνΈ λ° ν† ν° κµν™ κΈ°λ¥
- μ‹¤μ‹κ°„ κ±°λ λ‚΄μ—­ ν™•μΈ

### μƒλµλ κΈ°λ¥
- μΈμ¦ κ΄€λ ¨ κΈ°λ¥

## AI ν™μ© ν•­λ©

### Blockchain
- μΌλ¶€ ν…μ¤νΈ μ½”λ“ μƒμ„±
- μ»¨νΈλ™νΈ λ°°ν¬ μ½”λ“ μ‘μ„±
- μ»¨νΈλ™νΈ μ΄μ© μ½”λ“ μ‘μ„±

### Backend
- Entity μ •μ μ½”λ“ μƒμ„±
- DTO κ΄€λ ¨ μ½”λ“ μ‘μ„±
- Repository κ΄€λ ¨ μ½”λ“ μ‘μ„±
- λ‹¨μ„ ν…μ¤νΈ μ½”λ“ μƒμ„±

### Frontend
- λ€λ¶€λ¶„μ μ»΄ν¬λ„νΈ λ° λ΅μ§ μ½”λ“ μƒμ„±
